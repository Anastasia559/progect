<script>
   // let widget = document.getElementById("widget");    
    
   var onloadCallback = function() {
    }
   /* function callback(response){
        checksertbutton.disabled=false;
        emtydiv.innerHTML = response
    }
    function recaptchaExpired(){
        emtydiv.innerHTML = '';
        checksertbutton.disabled=true;
    }
  */

  function sendMessage() {
        grecaptcha.execute('6LfTPq8ZAAAAAC6pmmVMNC6oSgSbR3Pdya_faHaE', {action: 'autharmy'}).then(function(token) {

    var region = document.getElementById('region').value;
    var district = document.getElementById('district').value;
    var school = document.getElementById('school').value;
    var numberSert = document.getElementById('usersert').value;
    var abitfio = document.getElementById('abitfio').value;
    var abitphone = document.getElementById('abitphone').value;
    var textpas1 = document.getElementById("textpas1");
    var textpas2 = document.getElementById("textpas2");
    var textatestat = document.getElementById("textatestat");
    var textsert = document.getElementById("textsert");
    var textbilet = document.getElementById("textbilet");
    var message = document.getElementById('message').value;
    if('abitfio.length > 3 && abitphone.length > 3 && message.length > 30'){
            var xmlhttp = new XMLHttpRequest();
            var arrFromServer;
            var body = 
            'region=' + region  +
            '&district=' + district  +
            '&school=' + school  + 
            '&numberSert=' + numberSert  + 
            '&abitfio=' + abitfio  + 
            '&abitphone=' + abitphone + 
            '&message=' + message+ 
            '&ismilitary=' +1+ 
           // '&grecaptcharesponse=' + emtydiv.innerHTML +
            '&grecaptcharesponse=' + token +

            '&textpas1=' + textpas1.value +
            '&textpas2=' + textpas2.value +
            '&textatestat=' + textatestat.value +
            '&textsert=' + textsert.value +
            '&textbilet=' + textbilet.value;

            xmlhttp.onreadystatechange=function(){
                if(xmlhttp.readyState === XMLHttpRequest.DONE && xmlhttp.status === 200) {
                arrFromServer = JSON.parse(xmlhttp.responseText);
                console.log(arrFromServer);
                    if (arrFromServer.responseCode == 0) {
                      //  grecaptcha.reset(widget);
                        emtydiv.style.display = 'block';
                        emtydiv.innerHTML = "Ваше сообщение в адрес ЦООМО успешно отправлено!!!"
                        emtydiv.style.color = "green";
                        emtydiv.style.fontSize = "18px";
                        $('#modalOk').modal('show');
                        numberSert.value = "";
                        abitfio.value = "";
                        abitphone.value = "";
                        message.value = "";

                    }
                };
            }; 
            xmlhttp.open('post', '/sendmessagetosoomo', true);
            xmlhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded', 'charset=utf-8');
            xmlhttp.send(body);
    } else {
        emtydiv.innerHTML = "Заполните все поля, не спеша!!!"
        $('#modalError').modal('show');
        emtydiv.style.color = "red";
        emtydiv.style.fontSize = "18px";
    }
    }); 
 }


function auto_grow(element) {
    element.style.height = "5px";
    element.style.height = (element.scrollHeight)+"px";
}

document.getElementById('region').addEventListener("input", function(){document.getElementById('district').disabled = false;});
document.getElementById('district').addEventListener("input", function(){document.getElementById('school').disabled = false;});
document.getElementById('school').addEventListener("input", function(){document.getElementById('usersert').disabled = false;}); 
document.getElementById('usersert').addEventListener("input", function(){document.getElementById('abitfio').disabled = false;});
document.getElementById('abitfio').addEventListener("input", function(){document.getElementById('abitphone').disabled = false;});
document.getElementById('abitphone').addEventListener("click", 
function(){document.getElementById('message').disabled = false;
                pas1.disabled = false;
                pas2.disabled = false;
                atestat.disabled = false;
                sert.disabled = false;
                bilet.disabled = false;});
document.getElementById('message').addEventListener("input", function(){document.getElementById('checksertbutton').disabled = false;});
</script>
