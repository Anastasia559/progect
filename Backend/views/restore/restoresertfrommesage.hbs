  <div class="main" style="margin-top: -40px;">
        <div class="content">
                <div class="title mt-5">
                        <p class="secondary-text tn-text "> <a href="/" class="yellow_text underline">{{{__ "Главная"}}}</a>
                            &nbsp;/&nbsp; <a href="/soomo" class="yellow_text underline">{{{__ "ЦООМО"}}}</a>
                            &nbsp;/&nbsp;  <span class="secondary-text">{{title}} </span>
                          </p>
                        <h2 class="white-text  title_text mt-5">{{title}}</h2>

   <div class="row" style="margin-left: -5px;">

                    <div class="btn-group col-11 col-sm-3 col-md-2 white my-3 rounded mx-1 p-0" style="height: 60px;">
                        <a class="btn  m-0 dropdown-toggle font-weight-bold opacity-5 px-1" id="filter"
                            style="line-height: 40px;" data-toggle="dropdown" href="#">Фильтр <span
                                class="caret"></span></a>
                        <ul class="dropdown-menu filter-status">
                            <li class="pt-1 px-3" data-filter="*"><a class="filter-link">{{{__ "Все"}}}</a></li>
                            <li class="pt-1 px-3" data-filter=".rejected"><a class="filter-link">{{{__ "Отклонен"}}}</a></li>
                            <li class="pt-1 px-3" data-filter=".edited"><a class="filter-link">{{{__ "Изменен"}}}</a></li>
                            <li class="pt-1 px-3" data-filter=".waiting"><a class="filter-link">{{{__ "В процессе"}}}</a></li>
                        </ul>
                    </div>

                    <div class="  white my-3 rounded  col-11  col-sm-3  col-md-3 mx-1 mr-4" style="height: 60px;">

                        <input type="text" style="height: 60px;" id="search_input" class="quicksearch px-0 rounded"
                            placeholder="{{{__ 'Поиск'}}}" />

                    </div>
                    <button style="height: 60px;width:100px !important;"
                        class="yellow-color btn sm-text font-weight-bold white-text float-right isotope-reset m-3 px-1">{{{__ "Сброс"}}}</button>



                </div>



                    </div>
        </div>
    </div>


<div id="content" class="content">


  <div class="container-fluid">
            <div class="scrolling-wrapper row flex-row  mt-4 pb-4">

                <div class="rows my-0 mx-1">
                    <div class="d-lg-flex">
                        <div class="d-flex">
                            <div class="cell   sm-text opacity-5" style="width: 10px">№</div>
                            <div class="cell   sm-text opacity-5" style="width: 300px">{{{__ "ФИО"}}}</div>
                            <div class="cell   sm-text opacity-5" style="width: 140px">{{{__ "№ сертификата"}}}</div>
                            <div class="cell   sm-text opacity-5" style="width: 150px">{{{__ "Номер телефона"}}}</div>
                            <div class="cell   sm-text opacity-5" style="width: 200px">{{{__ "Сообщение"}}}</div>
                            <div class="cell   sm-text opacity-5" style="width: 100px">{{{__ "Статус"}}}</div>
                        </div>
                    </div>


                </div>
                <div class="iso bg-white">
        {{#each messages}}

                    <div class="rows my-0 mx-1 bg-white border-bottom iso-item   {{#ifCond action '==' 0}}rejected{{else}}{{#ifCond action '==' 1}}edited{{else}}waiting{{/ifCond}}{{/ifCond}}">
                        <div class="d-lg-flex">
                            <div class="d-flex">
                                <div class="cell sm-text" style="width: 10px">{{id_message_soomo}}</div>
                                <div class="cell sm-text" style="width: 300px">{{ab_fio}}</div>
                                <div class="cell sm-text" style="width: 140px">{{NumberSert}}</div>
                                <div class="cell sm-text" style="width: 150px">{{abit_phone}}</div>
                                <div class="cell sm-text" style="width: 200px">
                                  {{#ifCond message '==' 0 }}
                                  {{{../__ "Нет сообщений"}}}
                                  {{else}}
                                  <div class="border-r4  underline" data-toggle="popover" title='{{{../__ "Нажмите еще раз чтобы закрыть"}}}'
                                        data-content="{{message}}">
                                        <span title="{{{../__ 'Нажмите чтобы посмотреть полностью'}}}">{{{trimString message 0 15}}}...</span>
                                    </div>
                                  {{/ifCond}}


                                </div>
                            </div>
                        </div>
                        <div class="d-flex">
                            <div class="sm-text mr-2 mb-2">
                                <div class="border-r4 show-btn text-danger " style="padding-left:7px;" title="Статус">
                                {{#ifCond action '==' 0}} <span class="text-danger" title="{{{../__ 'Статус'}}}">{{{../__ "Отклонен"}}}</span>
                                {{else}}{{#ifCond action '==' 1}} <span class="text-success" title="{{{../__ 'Статус'}}}">{{{../__ "Изменен"}}}</span>
                                {{else}} <span class="color-blue" title="{{{../__ 'Статус'}}}">{{{../__ "В процессе"}}}</span>{{/ifCond}}{{/ifCond}} 
                                </div>

                            </div>
                            
                            <div class="sm-text  mb-2">
                                <div class="yellow-color text-center border-r4 show-btn">
                                    <a class="white-text" title="{{{../__ 'Посмотреть'}}}"  target="_self"
                                    href="/restoresertfrommesagesoomosearchid?id={{id_message_soomo}}&number={{NumberSert}}"
                                    data-id="{{id_message_soomo}}" data-number="{{NumberSert}}">{{{../__ "Посмотреть"}}}</a>
                                </div>
                                  
                                 
                            </div>
                        </div>

                    </div>
    {{/each}}
                </div>

            </div>
        </div>



{{!--


    <div class="content" style="background-color: #F9FBFF">
    <ul class="universities-flex mt-3">
        {{#each messages}}
        <li class="universities-item">
            <p class="university-name color-blue">{{id_message_soomo}}.  {{ab_fio}}</p>
            <div class="tn-text opacity-5">{{{__ "Номер сертификата"}}}:</div>
            <p class="sm-text mb-1">{{NumberSert}}</p>
            <div class="tn-text opacity-5">{{{__ "Номер телефона"}}}:</div>
            <p class="sm-text mb-1">{{abit_phone}}</p>
            <div class="tn-text opacity-5">{{{__ "Область"}}}:</div>
            <p class="sm-text mb-1">{{region}}</p>
            <div class="tn-text opacity-5">{{{__ "Район"}}}:</div>
            <p class="sm-text mb-1">{{district}}</p>
            <div class="tn-text opacity-5">{{{__ "Учебное заведение"}}}:</div>
            <p class="sm-text mb-1">{{school}}</p>

            <div class="tn-text opacity-5">{{{__ "Сообщение"}}}:</div>
            <p class="sm-text">{{message}}</p>
                            {{#if action}}
                                <div class="sm-text mr-2 mb-2">
                                    <button class="yellow-color text-center" style="background: #4267B7;
                                       border-radius: 4px; padding: 12px 15px; width: 120px;" data-toggle="modal" data-target="#exampleModal" 
                                        data-id="{{id_message_soomo}}" data-number="{{NumberSert}}"
                                         title="{{{__ 'Подробнее'}}}">{{{__ "Посмотреть"}}}</button>
                                </div>
                            {{else}}
                                <div class="sm-text ">
                
                                    
                                        <button class="white-text yellow-color text-center" style="
                                       border-radius: 4px; padding: 12px 15px; width: 120px;" data-toggle="modal" data-target="#exampleModal" 
                                        data-id="{{id_message_soomo}}" data-number="{{NumberSert}}"
                                         title="{{{__ 'Подробнее'}}}"
                                          >{{{__ "Посмотреть"}}}</button>
                                  
                                </div>

                            {{/if}}

        </li>
        {{/each}}
    </ul>
    </div>
   --}}


    <div class="modal fade  bd-example-modal-lg" id="exampleModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog  modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">{{{__ "Сообщение от абитуриента: "}}}<label id="idmes"></label></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="{{{__ "Закрыть"}}}">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row"></div>
                    <div class="form-group animated fadeIn" id="search_form">
                          <div class="form-row">
                            <div class="form-group col-md-12 mb-1">
                                <label>{{{__ "ФИО"}}}</label>
                                
                                <label id="fio"></label>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-12 mb-1">
                                <label>{{{__ "Номер  сертификата"}}}</label>
                                <label id="numberSert"></label>
                            </div>
                            <div class="form-group col-md-12 mb-1">
                                <label>{{{__ "Номер телефона"}}}</label>
                                <label id="phone"></label>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-12 mb-1">
                                <label>{{{__ "Область"}}}</label>
                                <label id="region"></label>
                            </div>

                            <div class="form-group col-md-12 mb-1">
                                <label> {{{__ "Район"}}}</label>
                                <label id="district"> </label>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-12 mb-1">
                                <label> {{{__ "Школа"}}}</label>
                                <label id="school"> </label>
                            </div>                          
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-12 mb-1">
                                <label> {{{__ "Сообщение"}}}</label>
                                <label id="message"> </label>
                            </div>
                        </div>

                    </div>
                <div class="row">
                    <div id="ort_div" class="col">
                        <p>{{{__ "ОРТ"}}}</p>
                        <img id="ort_image" draggable="true" class="img-fluid zoom zoom7 animated fadeIn" src="" alt="ORT">
                    </div>
                    <div class="col" id="pas_div">
                        <p>{{{__ "Паспорт"}}}</p>
                        <img id="pas_image" class="img-fluid zoom zoom7 animated fadeIn" src="" alt="Passport">        
                    </div>
                    <div class="col" id="pas2_div">
                        <p>{{{__ "Паспорт 2"}}}</p>
                        <img id="pas2_image" class="img-fluid zoom zoom7 animated fadeIn" src="" alt="Passport2"> 
                    </div>
                    <div class="col" id="ate_div" style="display:none">
                        <p>{{{__ "Аттестат"}}}</p>
                        <img id="ate_image" class="img-fluid zoom zoom7 animated fadeIn" src="" alt="Atestat">  
                    </div>
                   
                    <div class="col"   id="mil_div"  >
                        <p>{{{__ "Военный билет"}}}</p>
                        <img id="mil_image" class="img-fluid zoom zoom7 animated fadeIn" src="" alt="Military">
                    </div>
                    
                 </div>
                </div>
                <div class="modal-footer" >
                    <button type="button" id="cancel" class="btn btn-secondary cancel"
                        data-dismiss="modal">{{{__ "Закрыть"}}}</button>
                    <a type="button" href="/updatesert" id="search" class="btn btn-success"
                         >{{{__ "Поиск"}}}</a>
                    <button type="button"  data-active="0" data-number="" data-id=""
                        class="btn btn-danger  post" onclick="getAction(1);">{{{__ "Отклонить"}}}</button>
                    <button type="button"  data-active="1" data-number="" data-id=""
                        class="btn btn-primary post" onclick="getAction(1);">{{{__ "Подтвердить"}}}</button>
                </div>
            </div>
        </div>
    </div>



</div>


    <script type="text/javascript" src="/js/isotope.min.js"></script>
    <script>
        var qsRegex;
        var buttonFilter;
        // init Isotope
        var $grid = $('.iso').isotope({
            itemSelector: '.iso-item',
            layoutMode: 'fitRows',
            filter: function () {
                var $this = $(this);
                var searchResult = qsRegex ? $this.text().match(qsRegex) : true;
                var buttonResult = buttonFilter ? $this.is(buttonFilter) : true;
                return searchResult && buttonResult;
            },
        });
        $('.filter-status').on('click', 'li', function () {
            buttonFilter = $(this).attr('data-filter');
            $grid.isotope();
        });

        // use value of search field to filter
        var $quicksearch = $('.quicksearch').keyup(debounce(function () {
            qsRegex = new RegExp($quicksearch.val(), 'gi');
            $grid.isotope();
        }, 200));

        // debounce so filtering doesn't happen every millisecond
        function debounce(fn, threshold) {
            var timeout;
            threshold = threshold || 100;
            return function debounced() {
                clearTimeout(timeout);
                var args = arguments;
                var _this = this;
                function delayed() {
                    fn.apply(_this, args);
                }
                timeout = setTimeout(delayed, threshold);
            };
        }

        $(".dropdown-menu li a").click(function () {
            var selText = $(this).text();
            $(this).parents('.btn-group').find('.dropdown-toggle').html(selText + ' <span class="caret"></span>');
        });


        $(".isotope-reset").click(function () {
            $("#search_input").val("");
            $("#filter").html('Фильтр <span class="caret"></span>');
            buttonFilter = "*";
            qsRegex = "";
            $grid.isotope();

        });


        $(function () {
            $('[data-toggle="popover"]').popover()
        })
    </script>



<script>


    
function getAction(action) {
            var idmes = document.getElementById("idmes").innerHTML;
            var xmlhttp = new XMLHttpRequest();
            var arrFromServer;
            var body = 'action=' + action + '&idmes=' + idmes;
            xmlhttp.onreadystatechange=function(){
                if(xmlhttp.readyState === XMLHttpRequest.DONE && xmlhttp.status === 200) {
                arrFromServer = JSON.parse(xmlhttp.responseText);
                window.location.href = "/restoresertfrommesagesoomo";
                };
            }; 
            xmlhttp.open('post', '/actionsoomo', true);
            xmlhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded', 'charset=utf-8');
            xmlhttp.send(body);
}






      $('#exampleModal1').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget) // Button that triggered the modal
        var id = button.data('id') // Extract info from data-* attributes
        var number = button.data('number') // Extract info from data-* attributes




      

       /// console.log($("#verify").data("number"));

        $.ajax({
            url: "/restoresertfrommesagesoomoajax",
            type: "post",
            dataType: "text",
            data: {
                id: id,
                number: number
            },
            success: function (a) {
                const res = JSON.parse(a);
                $('#numberSert').html('<strong> ' + res.number + '</strong>');
                $('#phone').html('<strong> ' + res.abit_phone + '</strong>');
                $('#idmes').html(res.id);
                $('#fio').html('<strong> ' + res.ab_fio + '</strong>');
                $('#region').html('<strong> ' + res.region + '</strong>');
                $('#district').html('<strong> ' + res.district + '</strong>');
                $('#school').html('<strong> ' + res.school + '</strong>');
                $('#message').html('<strong> ' + res.message + '</strong>');
              
        console.log('id'+res.id);

       

                if (res.isort){
                $("#ort_image").attr("src", "data:img/png;base64," + res.ort);
                $("#ort_div").show();
                } else { $("#ort_div").hide();};
                if (res.ispas){
                $("#pas_image").attr("src", "data:img/png;base64," + res.pas);
                
                $("#pas_div").show();
                } else { $("#pas_div").hide();};

                if (res.ispas2){
                $("#pas2_image").attr("src", "data:img/png;base64," + res.pas2);
                $("#pas2_div").show();
                } else { $("#pas2_div").hide();};
               
                if (res.isate){
                $("#ate_image").attr("src", "data:img/png;base64," + res.ate);
                $("#ate_div").show();
                } else { $("#ate_div_div").hide();};

                 if (res.ismil){
                $("#mil_image").attr("src", "data:img/png;base64," + res.mil);
                $("#mil_div").show();
                 } else { $("#mil_div").hide();};
            }
        });
    })




  $('#exampleModal1').on('hidden.bs.modal', function () {
        $("#ort_image").attr("src", "");
        $("#ate_image").attr("src", "");
        $("#pas_image").attr("src", "");
        $("#pas2_image").attr("src", "");
        $("#mil_image").attr("src", "");
        $('#numberSert').html("");
        $('#phone').html("");
        $('#fio').html("");
        $('#region').html("");
        $('#district').html("");
        $('#school').html("");
        $('#message').html("");
        $('#ort_div').hide();
        $('#ate_div').hide();
        $('#pas_div').hide();
        $('#pas2_div').hide();
        $('#mil_div').hide();

     });

    $('img').bind('contextmenu', function (e) {
        return false;
    });

    $('.zoom').on('mousemove', function (event) {
        // This gives you the position of the image on the page
        var bbox = event.target.getBoundingClientRect();

        // Then we measure how far into the image the mouse is in both x and y directions
       var mouseX = event.clientX - bbox.left;
        var mouseY = event.clientY - bbox.top;

        // Then work out how far through the image as a percentage the mouse is
       var xPercent = (mouseX / bbox.width) * 100;
        var yPercent = (mouseY / bbox.height) * 100;

        // Then we change the `transform-origin` css property on the image to center the zoom effect on the mouse position
        //event.target.style.transformOrigin = xPercent + '% ' + yPercent + '%';
        // It's a bit clearer in jQuery:
 
       $(this).css('transform-origin', (xPercent + '% ' + yPercent + '%'));

        // We add the '%' units to make sure the string looks exactly like the css declaration it becomes.

    });
</script>

